<?xml version="1.0" ?>

<Problem>

    <Solvers gravityVector="{0.,0.,-9.81}">
        <CompositionalMultiphaseReservoir
                name="coupledFlowAndWells"
                flowSolverName="compositionalMultiphaseFlow"
                wellSolverName="compositionalMultiphaseWell"
                logLevel="1"
                initialDt="1e2"
                targetRegions="{ reservoir1, reservoir2, reservoir3, reservoir4, reservoir5, reservoir6, reservoir7, wellRegion1, wellRegion2 }">
            <NonlinearSolverParameters
                    newtonTol="1.0e-3"
                    maxTimeStepCuts="10"
                    maxSubSteps="20"
                    newtonMaxIter="40"/>
            <LinearSolverParameters
                    solverType="fgmres"
                    preconditionerType="mgr"
                    krylovTol="1e-6"
                    logLevel="1"/>
        </CompositionalMultiphaseReservoir>

        <CompositionalMultiphaseFVM
                name="compositionalMultiphaseFlow"
                targetRegions="{ reservoir1, reservoir2, reservoir3, reservoir4, reservoir5, reservoir6, reservoir7 }"
                discretization="fluidTPFA"
                temperature="293"
                maxCompFractionChange="0.2"
                logLevel="1"
                useMass="1"/>

        <CompositionalMultiphaseWell
                name="compositionalMultiphaseWell"
                targetRegions="{ wellRegion1, wellRegion2 }"
                logLevel="1"
                useMass="1">
            <WellControls
                    name="wellControls1"
                    type="injector"
                    logLevel="2"
                    control="totalVolRate"
                    referenceElevation="-900"
                    targetBHP="1e10"
                    enableCrossflow="0"
                    targetTotalRateTableName="totalRateTable1"
                    useSurfaceConditions="1"
                    surfacePressure="101325"
                    surfaceTemperature="293.71"
                    injectionTemperature="283.71"
                    injectionStream="{ 1.0, 0.0 }"/>
            <WellControls
                    name="wellControls2"
                    type="injector"
                    logLevel="2"
                    control="totalVolRate"
                    referenceElevation="-500"
                    targetBHP="1e10"
                    enableCrossflow="0"
                    targetTotalRateTableName="totalRateTable2"
                    useSurfaceConditions="1"
                    surfacePressure="101325"
                    surfaceTemperature="293.71"
                    injectionTemperature="283.71"
                    injectionStream="{ 1.0, 0.0 }"/>
        </CompositionalMultiphaseWell>
    </Solvers>

    <ElementRegions>
        <CellElementRegion
                name="reservoir1"
                cellBlocks="{ 1_hexahedra }"
                materialList="{ fluid, rock, relperm1, cappres1,thermalCond1 }"/>
        <CellElementRegion
                name="reservoir2"
                cellBlocks="{ 2_hexahedra }"
                materialList="{ fluid, rock, relperm2, cappres2,thermalCond2}"/>
        <CellElementRegion
                name="reservoir3"
                cellBlocks="{ 3_hexahedra }"
                materialList="{ fluid, rock, relperm3, cappres3,thermalCond3}"/>
        <CellElementRegion
                name="reservoir4"
                cellBlocks="{ 4_hexahedra }"
                materialList="{ fluid, rock, relperm4, cappres4,thermalCond4}"/>
        <CellElementRegion
                name="reservoir5"
                cellBlocks="{ 5_hexahedra }"
                materialList="{ fluid, rock, relperm5, cappres5,thermalCond5}"/>
        <CellElementRegion
                name="reservoir6"
                cellBlocks="{ 6_hexahedra }"
                materialList="{ fluid, rock, relperm6, cappres6,thermalCond6}"/>
        <CellElementRegion
                name="reservoir7"
                cellBlocks="{ 7_hexahedra }"
                materialList="{ fluid, rock, relperm7, cappres7,thermalCond7}"/>

        <WellElementRegion
                name="wellRegion1"
                materialList="{ fluid, relperm5,thermalCond5 }"/>
        <WellElementRegion
                name="wellRegion2"
                materialList="{ fluid, relperm5,thermalCond5 }"/>
    </ElementRegions>

    <NumericalMethods>
        <FiniteVolume>
            <TwoPointFluxApproximation
                    name="fluidTPFA"/>
        </FiniteVolume>
    </NumericalMethods>

    <Constitutive>
        <CO2BrinePhillipsFluid
                name="fluid"
                phaseNames="{ gas, water }"
                componentNames="{ co2, water }"
                componentMolarWeight="{ 44e-3, 18e-3 }"
                phasePVTParaFiles="{ tables_spe11b/pvtgas.txt, tables_spe11b/pvtliquid.txt }"
                flashModelParaFile="tables_spe11b/co2flash.txt"/>
        <SolidInternalEnergy
                name="rockInternalEnergy"
                volumetricHeatCapacity="2.125e6"
                referenceTemperature="343.15"
                referenceInternalEnergy="0"/>

        <CompressibleSolidConstantPermeability
                name="rock"
                solidModelName="nullSolid"
                porosityModelName="rockPorosity"
                permeabilityModelName="rockPerm"
                solidInternalEnergyModelName="rockInternalEnergy"/>
        <NullModel
                name="nullSolid"/>
        <PressurePorosity
                name="rockPorosity"
                defaultReferencePorosity="0.1"
                referencePressure="1.0e5"
                compressibility="4.5e-17"/>
        <ConstantPermeability
                name="rockPerm"
                permeabilityComponents="{ 1.0e-12, 1.0e-12, 1.0e-12 }"/>

        <!-- Problem 3.2 is hysteretical only -->

        <!-- kr per facies -->
        <BrooksCoreyRelativePermeability
                name="relperm1"
                phaseNames="{ gas, water }"
                phaseMinVolumeFraction="{ 0.1, 0.32 }"
                phaseRelPermExponent="{ 1.5, 1.5 }"
                phaseRelPermMaxValue="{ 1.0, 1.0 }"/>
        <BrooksCoreyRelativePermeability
                name="relperm2"
                phaseNames="{ gas, water }"
                phaseMinVolumeFraction="{ 0.1, 0.14 }"
                phaseRelPermExponent="{ 1.5, 1.5 }"
                phaseRelPermMaxValue="{ 1.0, 1.0 }"/>
        <BrooksCoreyRelativePermeability
                name="relperm3"
                phaseNames="{ gas, water }"
                phaseMinVolumeFraction="{ 0.1, 0.12 }"
                phaseRelPermExponent="{ 1.5, 1.5 }"
                phaseRelPermMaxValue="{ 1.0, 1.0 }"/>
        <BrooksCoreyRelativePermeability
                name="relperm4"
                phaseNames="{ gas, water }"
                phaseMinVolumeFraction="{ 0.1, 0.12 }"
                phaseRelPermExponent="{ 1.5, 1.5 }"
                phaseRelPermMaxValue="{ 1.0, 1.0 }"/>
        <BrooksCoreyRelativePermeability
                name="relperm5"
                phaseNames="{ gas, water }"
                phaseMinVolumeFraction="{ 0.1, 0.12 }"
                phaseRelPermExponent="{ 1.5, 1.5 }"
                phaseRelPermMaxValue="{ 1.0, 1.0 }"/>
        <BrooksCoreyRelativePermeability
                name="relperm6"
                phaseNames="{ gas, water }"
                phaseMinVolumeFraction="{ 0.1, 0.10 }"
                phaseRelPermExponent="{ 1.5, 1.5 }"
                phaseRelPermMaxValue="{ 1.0, 1.0 }"/>
        <!-- impermeable model -->
        <BrooksCoreyRelativePermeability
                name="relperm7"
                phaseNames="{ gas, water }"
                phaseMinVolumeFraction="{ 0.1, .1 }"
                phaseRelPermExponent="{ 1.5, 1.5 }"
                phaseRelPermMaxValue="{ 0.0001, 0.0001 }"/>

        <!-- cap per facies 	-->
        <TableCapillaryPressure
                name="cappres1"
                phaseNames="{ gas, water }"
                wettingNonWettingCapPressureTableName="cappresTable1"
        />
        <TableCapillaryPressure
                name="cappres2"
                phaseNames="{ gas, water }"
                wettingNonWettingCapPressureTableName="cappresTable2"
        />
        <TableCapillaryPressure
                name="cappres3"
                phaseNames="{ gas, water }"
                wettingNonWettingCapPressureTableName="cappresTable3"
        />
        <TableCapillaryPressure
                name="cappres4"
                phaseNames="{ gas, water }"
                wettingNonWettingCapPressureTableName="cappresTable4"
        />
        <TableCapillaryPressure
                name="cappres5"
                phaseNames="{ gas, water }"
                wettingNonWettingCapPressureTableName="cappresTable5"
        />
        <TableCapillaryPressure
                name="cappres6"
                phaseNames="{ gas, water }"
                wettingNonWettingCapPressureTableName="cappresTable6"
        />
        <TableCapillaryPressure
                name="cappres7"
                phaseNames="{ gas, water }"
                wettingNonWettingCapPressureTableName="cappresTable7"
        />

        <MultiPhaseVolumeWeightedThermalConductivity
                name="thermalCond1"
                phaseNames="{gas, water}"
                phaseThermalConductivity="{20.3e-3,.66}"
                rockThermalConductivityComponents="{ 1.9,1.9,1.9 }"/>
        <MultiPhaseVolumeWeightedThermalConductivity
                name="thermalCond2"
                phaseNames="{gas, water}"
                phaseThermalConductivity="{20.3e-3,.66}"
                rockThermalConductivityComponents="{ 1.25,1.25,1.25 }"/>
        <MultiPhaseVolumeWeightedThermalConductivity
                name="thermalCond3"
                phaseNames="{gas, water}"
                phaseThermalConductivity="{20.3e-3,.66}"
                rockThermalConductivityComponents="{ 1.25,1.25,1.25 }"/>
        <MultiPhaseVolumeWeightedThermalConductivity
                name="thermalCond4"
                phaseNames="{gas, water}"
                phaseThermalConductivity="{20.3e-3,.66}"
                rockThermalConductivityComponents="{ 1.25,1.25,1.25 }"/>
        <MultiPhaseVolumeWeightedThermalConductivity
                name="thermalCond5"
                phaseNames="{gas, water}"
                phaseThermalConductivity="{20.3e-3,.66}"
                rockThermalConductivityComponents="{ .92,.92,.92 }"/>
        <MultiPhaseVolumeWeightedThermalConductivity
                name="thermalCond6"
                phaseNames="{gas, water}"
                phaseThermalConductivity="{20.3e-3,.66}"
                rockThermalConductivityComponents="{ .26,.26,.26 }"/>
        <MultiPhaseVolumeWeightedThermalConductivity
                name="thermalCond7"
                phaseNames="{gas, water}"
                phaseThermalConductivity="{20.3e-3,.66}"
                rockThermalConductivityComponents="{ 2.,2.,2. }"/>
    </Constitutive>

    <FieldSpecifications>
        <HydrostaticEquilibrium
                name="equil"
                objectPath="ElementRegions/reservoir*"
                datumElevation="0."
                datumPressure="2e7"
                initialPhaseName="water"
                componentNames="{ co2, water }"
                componentFractionVsElevationTableNames="{ initCO2CompFracTable,
                                              initWaterCompFracTable }"
                temperatureVsElevationTableName="initTempTable"/>

        <FieldSpecification
                name="topfixedtemperature"
                objectPath="faceManager"
                fieldName="temperature"
                scale="313"
                setNames="{ top }"/>
        <FieldSpecification
                name="topfixedpressure"
                objectPath="faceManager"
                fieldName="pressure"
                scale="2.00e7"
                setNames="{ top }"/>
        <FieldSpecification
                name="BCComposition_gas"
                setNames="{ top }"
                objectPath="faceManager"
                fieldName="globalCompFraction"
                component="0"
                scale="0.0"/>
        <FieldSpecification
                name="BCComposition_water"
                setNames="{ top }"
                objectPath="faceManager"
                fieldName="globalCompFraction"
                component="1"
                scale="1.0"/>
        <FieldSpecification
                name="permx1"
                initialCondition="1"
                component="0"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir1"
                fieldName="rockPerm_permeability"
                scale="1e-16"/>
        <FieldSpecification
                name="permy1"
                initialCondition="1"
                component="1"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir1"
                fieldName="rockPerm_permeability"
                scale="1e-16"/>
        <FieldSpecification
                name="permz1"
                initialCondition="1"
                component="2"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir1"
                fieldName="rockPerm_permeability"
                scale="1e-17"/>

        <FieldSpecification
                name="permx2"
                initialCondition="1"
                component="0"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir2"
                fieldName="rockPerm_permeability"
                scale="1e-13"/>
        <FieldSpecification
                name="permy2"
                initialCondition="1"
                component="1"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir2"
                fieldName="rockPerm_permeability"
                scale="1e-13"/>
        <FieldSpecification
                name="permz2"
                initialCondition="1"
                component="2"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir2"
                fieldName="rockPerm_permeability"
                scale="1e-14"/>
        <FieldSpecification
                name="permx3"
                initialCondition="1"
                component="0"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir3"
                fieldName="rockPerm_permeability"
                scale="2e-13"/>
        <FieldSpecification
                name="permy3"
                initialCondition="1"
                component="1"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir3"
                fieldName="rockPerm_permeability"
                scale="2e-13"/>
        <FieldSpecification
                name="permz3"
                initialCondition="1"
                component="2"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir3"
                fieldName="rockPerm_permeability"
                scale="2e-14"/>
        <FieldSpecification
                name="permx4"
                initialCondition="1"
                component="0"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir4"
                fieldName="rockPerm_permeability"
                scale="5e-13"/>
        <FieldSpecification
                name="permy4"
                initialCondition="1"
                component="1"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir4"
                fieldName="rockPerm_permeability"
                scale="5e-13"/>
        <FieldSpecification
                name="permz4"
                initialCondition="1"
                component="2"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir4"
                fieldName="rockPerm_permeability"
                scale="5e-14"/>
        <FieldSpecification
                name="permx5"
                initialCondition="1"
                component="0"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir5"
                fieldName="rockPerm_permeability"
                scale="1e-12"/>
        <FieldSpecification
                name="permy5"
                initialCondition="1"
                component="1"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir5"
                fieldName="rockPerm_permeability"
                scale="1e-12"/>
        <FieldSpecification
                name="permz5"
                initialCondition="1"
                component="2"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir5"
                fieldName="rockPerm_permeability"
                scale="1e-13"/>
        <FieldSpecification
                name="permx6"
                initialCondition="1"
                component="0"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir6"
                fieldName="rockPerm_permeability"
                scale="2e-12"/>
        <FieldSpecification
                name="permy6"
                initialCondition="1"
                component="1"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir6"
                fieldName="rockPerm_permeability"
                scale="2e-12"/>
        <FieldSpecification
                name="permz6"
                initialCondition="1"
                component="2"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir6"
                fieldName="rockPerm_permeability"
                scale="2e-13"/>
        <FieldSpecification
                name="permx7"
                initialCondition="1"
                component="0"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir7"
                fieldName="rockPerm_permeability"
                scale="1e-26"/>
        <FieldSpecification
                name="permy7"
                initialCondition="1"
                component="1"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir7"
                fieldName="rockPerm_permeability"
                scale="1e-26"/>
        <FieldSpecification
                name="permz7"
                initialCondition="1"
                component="2"
                setNames="{ all }"
                objectPath="ElementRegions/reservoir7"
                fieldName="rockPerm_permeability"
                scale="1e-26"/>



    </FieldSpecifications>

    <Functions>
        <TableFunction
                name="initCO2CompFracTable"
                coordinates="{ -1200, 0 }"
                values="{ 0.000001, 0.000001 }"/>
        <TableFunction
                name="initWaterCompFracTable"
                coordinates="{ -1200, 0 }"
                values="{ 0.999999, 0.999999 }"/>
        <TableFunction
                name="initTempTable"
                coordinates="{ -1200, 0 }"
                values="{ 343. ,313. }"/>


        <TableFunction
                name="totalRateTable1"
                inputVarNames="{time}"
                coordinates="{0, 7.884e8, 1.5768e9, 1.576800001e9, 3.153600e10}"
                values="{ 0.01905, 0.01905, 0.01905, 0, 0}"
                interpolation="lower"/>
        <TableFunction
                name="totalRateTable2"
                inputVarNames="{time}"
                coordinates="{0, 7.8839999e8, 7.884e8, 1.5768e9, 1.576800001e9, 3.153600e10}"
                values="{0., 0., 0.01905, 0.01905, 0, 0}"
                interpolation="lower"/>
        <TableFunction
                name="cappresTable1"
                coordinateFiles="{ tables_spe11b/waterPCSaturation_spe11b_1.txt}"
                voxelFile="tables_spe11b/waterCapPres_spe11b_1.txt"/>
        <TableFunction
                name="cappresTable2"
                coordinateFiles="{ tables_spe11b/waterPCSaturation_spe11b_2.txt}"
                voxelFile="tables_spe11b/waterCapPres_spe11b_2.txt"/>
        <TableFunction
                name="cappresTable3"
                coordinateFiles="{ tables_spe11b/waterPCSaturation_spe11b_3.txt}"
                voxelFile="tables_spe11b/waterCapPres_spe11b_3.txt"/>
        <TableFunction
                name="cappresTable4"
                coordinateFiles="{ tables_spe11b/waterPCSaturation_spe11b_4.txt}"
                voxelFile="tables_spe11b/waterCapPres_spe11b_4.txt"/>
        <TableFunction
                name="cappresTable5"
                coordinateFiles="{ tables_spe11b/waterPCSaturation_spe11b_5.txt}"
                voxelFile="tables_spe11b/waterCapPres_spe11b_5.txt"/>
        <TableFunction
                name="cappresTable6"
                coordinateFiles="{ tables_spe11b/waterPCSaturation_spe11b_6.txt}"
                voxelFile="tables_spe11b/waterCapPres_spe11b_6.txt"/>
        <TableFunction
                name="cappresTable7"
                coordinateFiles="{ tables_spe11b/waterPCSaturation_spe11b_7.txt}"
                voxelFile="tables_spe11b/waterCapPres_spe11b_7.txt"/>

    </Functions>

    <Geometry>
        <Box
                name="top"
                xMin="{ -1.0, -0.1, -11.5 }"
                xMax="{ 8401.0, 1.1, -0. }"/>
    </Geometry>

    <Mesh>
        <VTKMesh
                name="mesh"
                file="./meshes/spe11b_structured_extruded_coarsened.vtu"
                regionAttribute="attribute"
                fieldsToImport="{PORO}"
                partitionRefinement="5"
                logLevel="5"
                fieldNamesInGEOSX="{ rockPorosity_referencePorosity }">
            <InternalWell
                    name="wellInjector1"
                    wellRegionName="wellRegion1"
                    wellControlsName="wellControls1"
                    logLevel="1"
                    polylineNodeCoords="{ { 2700., 0.5, -898.8 },
                            { 2700., 0.5 , -908.8 } }"
                    polylineSegmentConn="{ { 0, 1 } }"
                    radius="0.15"
                    minSegmentLength="0.0001"
                    numElementsPerSegment="1">
                <Perforation
                        name="injector1_perf1"
                        distanceFromHead="9.9"/>
            </InternalWell>
            <InternalWell
                    name="wellInjector2"
                    wellRegionName="wellRegion2"
                    wellControlsName="wellControls2"
                    logLevel="1"
                    polylineNodeCoords="{ { 5100., 0.5, -498.8},
                            { 5100., 0.5, -508.8 } }"
                    polylineSegmentConn="{ { 0, 1 } }"
                    radius="0.15"
                    minSegmentLength="0.0001"
                    numElementsPerSegment="1">
                <Perforation
                        name="injector2_perf1"
                        distanceFromHead="9.9"/>
            </InternalWell>
        </VTKMesh>
    </Mesh>


    <Tasks>
        <CompositionalMultiphaseStatistics
                name="compflowStatistics"
                flowSolverName="compositionalMultiphaseFlow"
                logLevel="1"
                computeCFLNumbers="1"
                computeRegionStatistics="1"/>
    </Tasks>

    <Outputs>
        <VTK
                name="simpleReservoirViz"/>
        <Restart
                name="restartOutput"/>
    </Outputs>

    <Events
            maxTime="3.153600e10">

        <PeriodicEvent
                name="outputs"
                timeFrequency="1.5768e8"
                targetExactTimestep="1"
                target="/Outputs/simpleReservoirViz"/>

        <PeriodicEvent
                name="restarts"
                timeFrequency="3.153600e8"
                targetExactTimestep="1"
                target="/Outputs/restartOutput"/>

        <!-- SPHINX_STAT_EV -->
        <PeriodicEvent
                name="statistics"
                timeFrequency="1.5768e8"
                target="/Tasks/compflowStatistics"/>
        <!-- SPHINX_STAT_EV_END -->

        <PeriodicEvent
                name="solverApplications1"
                beginTime="0"
                endTime="7.884e8"
                target="/Solvers/coupledFlowAndWells"/>
        <PeriodicEvent
                name="solverApplications2"
                beginTime="7.884e8"
                endTime="1.5768e9"
                target="/Solvers/coupledFlowAndWells"/>
        <PeriodicEvent
                name="solverApplications3"
                beginTime="1.5768e9"
                endTime="3.153600e10"
                target="/Solvers/coupledFlowAndWells"/>

    </Events>
</Problem>
